{% extends "scan/layout.html" %}
{% block content %}
     <div class="col-lg-9">
        <h4>Welcome to the <b>SCAN SecureLink results portal.</b></h4>
        <p>
          If you are part of the SCAN/Seattle Flu Study and were tested for the SARS-CoV-2 (COVID-19) Virus, you can use this portal to retrieve the status and/or results of your testing. Only patients who received a test retrieval card at the time of their test are eligible to retrieve their results via this portal. <b>If you are a UW Medicine patient, Emergency Responder, or recevied your test via UW Medicine, <a href='/'>please use this link to retrieve your result.</a></b>
        <h4>To retrieve your test result, please enter the 8 digit retrieval code and your date of birth below:</h4>
        <div class='row'>
          <div class='col-lg-10'>
            <div id="form-card">
              <form action="/result" method="post" id="submitform">
                <input type="hidden" name="source" value="scan" />
                <div class="form-group col-md-12">
                  <label for="barcode">Retrieval Code <a id="showexample" href="#">(Where can I find this?)</a></label>
                  <div id="example">
                    This is listed on the test retrieval card, given to you at the time of testing:
                    <img src="/static/img/scan-example.png" width="400px" class="m-3" />
                  </div>
                  <input class="form-control"
                      id='barcode'
                      name="barcode"
                      aria-describedby="barcode"
                      placeholder="########"
                      value="{{ barcode }}"
                      type="text"
                      style="text-transform:uppercase"
                      autocomplete="off" 
                  />
                  <small id="barcodeHelp" class="form-text text-muted">8-digit retrieval code from your test information card.</small>
                </div>
                <div class="form-group col-md-6">
                  <label for="dob">Date of Birth</label>
                  <input class="form-control"
                    id='dob'
                    name="dob"
                    aria-describedby="dob"
                    placeholder="MM/DD/YYYY"
                    autocomplete="off"
                  / >
                  <small id="barcodeHelp" class="form-text text-muted">The date of birth for the patient tested.</small>
                </div>
                <div class="form-group col-md-12">
                  <button type="submit" class="btn btn-secondary float-right">Click here to retrieve results</button>
                </div>
              </form>
            </div>
          </div>

        </div>
          <div class='row'>
            <div class='col-lg-10'>
              <!-- <div class='card card-body bg-light'>
                <p><span class='font-weight-bold'>If you have lost your barcode or your access code does not show the status of your test after 48 hours</span>, please call the UW Medicine COVID-19 Patient Test Results line at (206) 520-8787. Please do <b>not</b> call if your test is shown as "in process" or "pending".</p>
              </div> -->
          </div>        
        <script>
        $(document).ready(
          $("#showexample").click(function () {
              $("#example").toggle();
          })
        );


        $("#barcode").mask("AAAAAAAA")
        $("#dob").mask("00/00/0000")
        jQuery.validator.addMethod("validBarcode", function(value) {
            return value.match(/(.{8})/g)
        }, "Please enter a valid 8-digit barcode.");


        jQuery.validator.addMethod("validDob", function(value) {
            return value.match(/([0-9]{2})\/([0-9]{2})\/(19|20[0-9]{2})/g)
        }, "Please enter a valid date of birth.");


        $("#submitform").validate({
          rules: {
            barcode: {
              validBarcode: true
            },
            dob: {
              validDob: true
            }
          },
          messages: {
            barcode: {
              required: "Please enter the 8-digit barcode.",
              minlength: "Barcode must be 8 digits. Please omit any dashes."
            },
            dob: {
              required: "Please enter date in MM/DD/YYYY format."
            }
          }
        });
        </script>
      </div>
{% endblock %}